@model Alquinet_Entidad.ClasesPropiedad.Departamento
@{
    ViewBag.Title = Model.Tipo;
}

<div class="container mt-3">
    <div class="row justify-content-center">
        <div class="col-md-8 mb-1 mx-n3">
            <div class="card h-100">
                <div class="row g-0">
                    <div class="col-md-12 px-4 py-3">
                        <div class="row row-cols-3 g-1">
                            <!-- Las primeras 5 imágenes se mostrarán en una cuadrícula de 3 columnas -->
                            @foreach (var foto in Model.Fotos)
                            {
                                <div class="col">
                                    <img src="data:image/jpeg;base64,@foto.Base64" class="img-fluid" alt="...">
                                </div>
                            }
                        </div>
                        <!-- Botón para abrir el modal con el carrusel -->
                        <div class="d-flex justify-content-center mt-3">
                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#imageCarouselModal">
                                Fotos
                            </button>
                        </div>
                        <div class="mt-3">
                            <h5 class="card-title">@Model.Titulo</h5>
                            <p class="card-text">Calle | @Model.Direccion.Calle</p>
                            <p class="card-text">Zona | @Model.Direccion.Zona</p>
                            <p class="card-text">Barrio | @Model.Direccion.Barrio</p>
                            <p class="card-text">Codigo postal | @Model.Direccion.Cod_pos</p>
                            <div class="table-responsive">
                                <table class="table">
                                    <tbody>
                                        <tr>
                                            <td><strong>Área</strong><br><strong> @Model.Area m²</strong><i class="fa-solid fa-expand"></i></td>
                                            <td><strong>Pisos</strong><br><strong> @Model.Planta </strong><i class="fa-solid fa-cube"></i></td>
                                            <td><strong>Edificio</strong><br><strong> @Model.NombreEdificio </strong><i class="fa-solid fa-building"></i></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <hr>
                            <div class="row">
                                <div class="col-sm-12 col-md-6 my-1">
                                    <ul class="list-unstyled">
                                        <li><i class="fa fa-tags"></i> Tipo: <strong> @Model.Tipo</strong><br></li>
                                        <li><i class="fa-solid fa-money-check"></i> Precio de Alquiler: <strong> @Model.Precio BOB</strong><br></li>
                                    </ul>
                                </div>
                            </div>
                            <hr>
                            <p class="card-text text-justify">
                                @Model.Descripcion
                            </p>
                            <hr>
                            <p class="card-text fs-5"><strong>Ubicación</strong><br></p>
                            <p class="card-text">Equipetrol, Santa Cruz, Bolivia.</p>
                            <div id="map" style="height: 350px;" class="mb-3"></div>
                            <div id="photosphere"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4 col-xl-3">
            <div class="card mb-2">
                <div class="card-body pt-2">
                    <div class="row">
                        <div class="col-sm-12 h5">
                            ID:@Model.Cod
                            <br>
                        </div>
                        <div class="col-sm-12 text-muted text-capitalize">Precio alquiler</div>
                        <div class="col-sm-12 h5">@Model.Precio BOB</div>
                        <div class="card sticky-top">
                            <div class="card-body">
                                <h5 class="card-title text-center"> ¿Necesitas más información?</h5>
                                <div class="text-center mb-4">
                                    <img class="img-fluid rounded mr-3" src="https://static.vecteezy.com/system/resources/previews/016/423/927/non_2x/call-center-agent-icon-design-free-vector.jpg" alt="Asesor Inés Arismendy Roca" style="height: 100px; margin: auto;">
                                    <h6 class="mt-2 card-subtitle mb-2 text-muted">@Model.Agente.Nombre @Model.Agente.Apellido</h6>
                                    <div class="text-center d-none">
                                        <div class="my-5 py-5 h5"></div>
                                    </div>
                                    <form name="prospectos" method="post" id="contacto1" class="form-horizontal fv-plugins-bootstrap fv-plugins-framework fv-plugins-bootstrap5" novalidate="novalidate">
                                        <div class="row mb-2 d-none">
                                            <div class="col-md pe-1">
                                                <div class="form-floating fv-plugins-icon-container">
                                                    <input type="text" id="prospectos_nombre" name="nombre" required="" placeholder="Nombre" class="form-control">
                                                    <label for="prospectos_nombre" class="col-form-label col-form-label-sm">Nombre</label>
                                                    <div class="fv-plugins-message-container invalid-feedback"></div>
                                                </div>
                                            </div>
                                            <div class="col-md ps-1">
                                                <div class="form-floating fv-plugins-icon-container">
                                                    <input type="text" id="prospectos_telefono" name="telefono" required="" placeholder="Ingresa tu teléfono" class="form-control">
                                                    <label for="prospectos_telefono" class="col-form-label col-form-label-sm">Teléfono</label>
                                                    <div class="fv-plugins-message-container invalid-feedback"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row my-2 d-none">
                                            <div class="col-md">
                                                <div class="form-floating fv-plugins-icon-container">
                                                    <input type="text" id="prospectos_email" name="email" required="" placeholder="Ingresa tu email" class="form-control">
                                                    <label for="prospectos_email" class="col-form-label col-form-label-sm">Email</label>
                                                    <div class="fv-plugins-message-container invalid-feedback"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md">
                                                <div class="form-floating fv-plugins-icon-container">
                                                    <textarea id="prospectos_mensaje" name="mensaje" required="" class="form-control" style="height: 100px;">Hola, me interesa esta propiedad
                                                        ID:@Model.Cod - Calle @Model.Direccion.Calle
                                                        @Model.Precio BOB
                                                    </textarea>
                                                    <label for="prospectos_mensaje">Mensaje</label>
                                                    <div class="fv-plugins-message-container invalid-feedback"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="d-flex justify-content-center mt-3">
                                            <a href="https://api.whatsapp.com/send?phone=@Model.Agente.Telefono" target="_blank" class="btn btn-success ms-2">
                                                Enviar WhatsApp
                                            </a>
                                        </div>
                                    </form>
                                    <div id="inline-badge" class="mt-4"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="imageCarouselModal" tabindex="-1" aria-labelledby="imageCarouselModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="imageCarouselModalLabel">Todas las fotos</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="carouselExample" class="carousel slide" data-bs-ride="carousel">
                    <div class="carousel-inner">
                        @foreach (var foto in Model.Fotos)
                        {
                            <div class="carousel-item @(foto == Model.Fotos.First() ? "active" : "")">
                                <img src="data:image/jpeg;base64,@foto.Base64" class="d-block mx-auto img-fluid" style="max-height: 400px;" alt="...">
                            </div>
                        }
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Anterior</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Siguiente</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        initMap();
    });

    function initMap() {
        const lat = @Model.Direccion.Latitud;
        const lng = @Model.Direccion.Longitud;
        const map = L.map('map').setView([lat, lng], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        const marker = L.marker([lat, lng]).addTo(map);
    }

    // Script para la imagen 360 grados
    const PSV = new PhotoSphereViewer.Viewer({
        panorama: '../images/depa360.jpg',
        container: document.querySelector('#photosphere'),
        loadingImg: 'https://learn.microsoft.com/es-es/visualstudio/extensibility/ux-guidelines/media/0404-08_view.png?view=vs-2022',
        navbar: 'autorotate zoom download fullscreen',
        caption: 'PROPIEDAD',
        defaultFov: 65,
        mousewheel: false,
        size: {
            height: 400
        }
    });

    // Selecciona el botón "Contactar" por su ID
    const contactButton = document.getElementById('prospectos_save');
    // Selecciona los elementos que deseas mostrar al hacer clic en el botón
    const hiddenElements = document.querySelectorAll('.row.mb-2, .row.my-2');

    // Agrega un evento de clic al botón "Contactar"
    contactButton.addEventListener('click', function () {
        hiddenElements.forEach(function (element) {
            element.classList.remove('d-none');
        });
        contactButton.disabled = true;
    });
</script>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photo-sphere-viewer@4/dist/photo-sphere-viewer.min.css" />
<script src="https://cdn.jsdelivr.net/npm/three@0.126.1/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photo-sphere-viewer@4/dist/photo-sphere-viewer.min.js"></script>
