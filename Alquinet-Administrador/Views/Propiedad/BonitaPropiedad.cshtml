@{
    ViewBag.Title = "Detalle de Propiedad";
}

<h2>Detalle de Propiedad</h2>

<div class="container">
    <div id="propiedadDetalles" class="row">
        <!-- Detalles de la propiedad se cargarán aquí -->
    </div>
    <div id="imagenesPropiedad" class="row mt-4">
        <!-- Imágenes de la propiedad se cargarán aquí -->
    </div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" />

    <script>
        $(document).ready(function () {
            var codPropiedad = 6; // Código de la propiedad a cargar

            $.ajax({
                url: '@Url.Action("ObtenerPropiedadConDetalles", "Propiedad")',
                type: 'GET',
                data: { cod: codPropiedad },
                success: function (response) {
                    if (response.operacion_exitosa) {
                        var propiedad = response.datos;
                        var detallesHtml = `
                            <div class="col-md-6">
                                <h3>${propiedad.Titulo}</h3>
                                <p><strong>Dirección:</strong> ${propiedad.Direccion.Calle}, ${propiedad.Direccion.Barrio}, ${propiedad.Direccion.Zona}</p>
                                <p><strong>Precio:</strong> ${propiedad.Precio}</p>
                                <p><strong>Descripción:</strong> ${propiedad.Descripcion}</p>
                            </div>
                        `;
                        $('#propiedadDetalles').html(detallesHtml);

                        var imagenesHtml = '';
                        propiedad.Fotos.forEach(function (foto) {
                            imagenesHtml += `
                                <div class="col-md-4">
                                    <div class="card mb-4">
                                        <img src="data:image/jpeg;base64,${foto.Base64}" class="card-img-top" alt="${foto.Ambiente}">
                                        <div class="card-body">
                                            <p class="card-text">${foto.Ambiente}</p>
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                        $('#imagenesPropiedad').html(imagenesHtml);
                    } else {
                        $('#propiedadDetalles').html(`<div class="alert alert-danger">${response.mensaje}</div>`);
                    }
                },
                error: function () {
                    alert('Error en la solicitud.');
                }
            });
        });
    </script>
}
